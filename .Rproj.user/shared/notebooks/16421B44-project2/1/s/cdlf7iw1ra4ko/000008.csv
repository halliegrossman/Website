"0","#out of sample CV FOLD"
"0","class_diag<-function(probs,truth){"
"0","  "
"0","  tab<-table(factor(probs>.5,levels=c(""FALSE"",""TRUE"")),truth)"
"0","  acc=sum(diag(tab))/sum(tab)"
"0","  sens=tab[2,2]/colSums(tab)[2]"
"0","  spec=tab[1,1]/colSums(tab)[1]"
"0","  ppv=tab[2,2]/rowSums(tab)[2]"
"0","  "
"0","  if(is.numeric(truth)==FALSE & is.logical(truth)==FALSE) truth<-as.numeric(truth)-1"
"0","  "
"0","  #CALCULATE EXACT AUC"
"0","  ord<-order(probs, decreasing=TRUE)"
"0","  probs <- probs[ord]; truth <- truth[ord]"
"0","  "
"0","  TPR=cumsum(truth)/max(1,sum(truth)) "
"0","  FPR=cumsum(!truth)/max(1,sum(!truth))"
"0","  "
"0","  dup<-c(prob[-1]>=prob[-length(prob)], FALSE)"
"0","  TPR<-c(0,TPR[!dup],1); FPR<-c(0,FPR[!dup],1)"
"0","  "
"0","  n <- length(TPR)"
"0","  auc<- sum( ((TPR[-1]+TPR[-n])/2) * (FPR[-1]-FPR[-n]) )"
"0","  "
"0","  data.frame(acc,sens,spec,ppv,auc)"
"0","}"
"0",""
"0","#10 fold CV"
"0","set.seed(1234)"
"0","k=10"
"0",""
"0","data1<-ICU[sample(nrow(ICU)),] #put dataset in random order"
"0","folds<-cut(seq(1:nrow(ICU)),breaks=k,labels=F) #create folds"
"0",""
"0","diags<-NULL"
"0","for(i in 1:k){          # FOR EACH OF 10 FOLDS"
"0","  train<-data1[folds!=i,] # CREATE TRAINING SET"
"0","  test<-data1[folds==i,]  # CREATE TESTING SET"
"0","  "
"0","  truth<-test$Survive"
"0","  "
"0","  #fit<- glm(YOUR MODEL FROM ABOVE HERE, FIT TO TRAINING SET, i.e., data=train)"
"0","  fit5<- glm(Survive ~ Age + SysBP, data = train, family = ""binomial"")"
"0","  #probs<- predict(GET PREDICTED PROBABILITIES FROM TRAINED MODEL USING TESTING SET AS NEW DATA, i.e., newdata=test)"
"0","  prob<-predict(fit5,newdata = test,type=""response"")"
"0","  "
"0","  diags<-rbind(diags,class_diag(prob,truth)) #CV DIAGNOSTICS FOR EACH FOLD"
"0","}"
"0",""
"0","summarize_all(diags,mean) #AVERAGE THE DIAGNOSTICS ACROSS THE 10 FOLDS"
